Exemple une application Tomcat sur RedHat 9 √† un Windows Server 2019/IIS utilisant l‚Äôauthentification SAML 2.0.
Dans ce sc√©nario, le plus fr√©quent est :

Tomcat = SP (Service Provider)

Windows Server 2019 + ADFS = IdP (Identity Provider)

IIS peut h√©berger ADFS ou des endpoints web n√©cessaires

Votre application Java/Tomcat sur RedHat 9 veut authentifier les utilisateurs.

Vous configurez votre application comme un Service Provider (SP) SAML.

Sur Windows Server 2019, vous utilisez ADFS (Active Directory Federation Services) comme Identity Provider (IdP).

Les utilisateurs sont redirig√©s depuis Tomcat ‚Üí ADFS ‚Üí retour vers Tomcat, avec un jeton SAML 2.0 sign√©.

==== Prerequis =====

Java 11+ (ou celui requis par votre appli)

Tomcat 9 ou 10

Un module SAML pour Java, comme :

Spring Security SAML 2.0 (le plus standard)

Keycloak Adapter si vous utilisez Keycloak en passerelle (optionnel)

Pac4j SAML (simple et efficace)

Shibboleth SP (moins courant sur Tomcat)

üëâ Je te conseille Spring Security SAML 2.0.

====================

Sur Windows Server 2019

Le r√¥le ADFS install√©

Un certificat SSL sur ADFS

L'acc√®s au Metadata.xml de l‚ÄôIdP :
https://<votre-adfs>/FederationMetadata/2007-06/FederationMetadata.xml


======================

Etape 2

Configurer votre application Tomcat comme Service Provider
(A) Installer une librairie SAML dans votre application

Exemple avec Spring Security SAML 2.0.

Ajoutez au pom.xml :

<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-saml2-service-provider</artifactId>
</dependency>

==========================

(B) Cr√©er les endpoints SAML dans votre application

Typiquement :

Endpoint	URL
Metadata SP	/saml/metadata
Login SAML	/saml/login
ACS (Assertion Consumer Service)	/saml/acs
Logout	/saml/logout

============================

Dans Spring Security :

http
    .saml2Login(withDefaults())
    .saml2Logout(withDefaults());

===========================

(C) G√©n√©rer le fichier metadata.xml du SP

Les librairies SAML permettent de l‚Äôobtenir automatiquement via :

https://<votre-application>/saml/metadata

Vous devrez r√©cup√©rer ce XML pour l‚Äôinstaller dans ADFS.

===========================

Configurer ADFS (Windows Server 2019) comme Identity Provider
(A) Cr√©er une ‚ÄúRelying Party Trust‚Äù (RP)

Dans ADFS :

Ouvrez ADFS ‚Üí Relying Party Trusts

Cliquez sur Add Relying Party Trust

Choisissez Import from URL or file

Importez le metadata du SP :

URL (si accessible)
https://<tomcat-server>/saml/metadata

ou fichier XML export√©

=============================

(B) Configurer les endpoints dans ADFS

Lors de la cr√©ation, ADFS lit le metadata SP et ajoute automatiquement :

ACS URL : https://<tomcat>/saml/acs

EntityID du SP : souvent https://<tomcat>/saml/metadata

==============================

(C) Attribuer les claims (attributs)

Dans ADFS, ajoutez des r√®gles d‚Äô√©mission de claims :

email

givenName

sn

role (facultatif)

Exemple minimal :

Send LDAP Attributes as Claims

LDAP attribute ‚Üí Claim type
E-Mail-Addresses ‚Üí email
SAM-Account-Name ‚Üí uid

==============================

4. R√©cup√©rer le Metadata de l‚ÄôIdP (ADFS)

Dans ADFS :

Acc√©dez √† :

https://<adfs-server>/FederationMetadata/2007-06/FederationMetadata.xml

Importez ce XML dans votre configuration Tomcat/SP.

==============================

5. Configurer le SP pour pointer vers ADFS
Exemple Spring Security YAML :

Code Yaml:

spring:
  security:
    saml2:
      relyingparty:
        registration:
          adfs:
            identityprovider:
              metadata-uri: "https://adfs.mondomaine.local/FederationMetadata/2007-06/FederationMetadata.xml"
            relyingparty-id: "https://tomcat.mondomaine.com/saml/metadata"
            signing:
              credentials:
                - private-key-location: "classpath:private.key"
                  certificate-location: "classpath:certificate.crt"


==============================

6. Configurer HTTPS / certificats
Sur Tomcat

Placez votre certificat dans :



===================================================================================





